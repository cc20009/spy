{
    "data" : [
        "",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "data=dt.spy",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n",
        "> ",
        "chr.trade_date <- '2014-01-06'",
        "> ",
        "dt.slim <- data[trade_date==chr.trade_date]",
        "> ",
        "dt.slim",
        "     symbol trade_date root expiration strike call_put   bid   ask underlying distance_from_underlying     iv  vol   delta    gamma     theta     vega       rho  vwap trade_volume      strip\n  1:    SPY 2014-01-06  SPY 2014-01-18    140        c 42.53 42.71     182.41                    42.41 0.0500   10  1.0000 0.000000 -0.000632 0.000000  4.219649 43.10           10 2014-01-01\n  2:    SPY 2014-01-06  SPY 2014-01-18    140        p  0.00  0.01     182.41                   -42.41 0.4976   50 -0.0009 0.000195",
        " -0.002216 0.000977 -0.005120  0.01           50 2014-01-01\n  3:    SPY 2014-01-06  SPY 2014-01-18    141        p  0.00  0.01     182.41                   -41.41 0.4847   25 -0.0009 0.000203 -0.002188 0.000990 -0.005193  0.01           25 2014-01-01\n  4:    SPY 2014-01-06  SPY 2014-01-18    143        p  0.00  0.01     182.41                   -39.41 0.4679  110 -0.0011 0.000257 -0.002573 0.001207 -0.006438  0.01          110 2014-01-01\n  5:    SPY 2014-01-06  SPY 2014-01-18    144        p  0.00  0.01     182.41",
        "                   -38.41 0.4500   10 -0.0010 0.000244 -0.002268 0.001106 -0.005846  0.01           10 2014-01-01\n ---                                                                                                                                                                                          \n547:    SPY 2014-01-06  SPY 2014-12-20    197        c  3.49  3.53     182.41                   -14.59 0.1321   10  0.2576 0.013593 -0.008854 0.569412 41.449349  3.69           10 2014-12-01\n548:    SPY 2014-01-06",
        "  SPY 2014-12-20    200        c  2.66  2.72     182.41                   -17.59 0.1285 1941  0.2143 0.012641 -0.007887 0.515026 34.690201  2.71         1941 2014-12-01\n549:    SPY 2014-01-06  SPY 2014-12-20    205        c  1.64  1.69     182.41                   -22.59 0.1228  220  0.1497 0.010579 -0.006140 0.411915 24.456098  1.76          220 2014-12-01\n550:    SPY 2014-01-06  SPY 2014-12-20    210        c  0.98  1.02     182.41                   -27.59 0.1191  500  0.1003 0.008251 -0.004579 0.311573 16.501347",
        "  1.00          500 2014-12-01\n551:    SPY 2014-01-06  SPY 2014-12-20    215        c  0.56  0.61     182.41                   -32.59 0.1165  100  0.0646 0.006061 -0.003262 0.223824 10.689745  0.59          100 2014-12-01\n",
        "> ",
        "dt.portfolio[trade_date == max(dt.portfolio$trade_date)]",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.48045 0.46        11779 2014-01-01   1        1\n2:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807",
        " 0.015739 -0.010518 0.542770 37.57267 3.56          184 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.57267 3.56          184 2014-10-01   0        2\n",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "dt.portfolio.slim <- dt.portfolio[trade_date == max(dt.portfolio$trade_date)]",
        "> ",
        "dt.portfolio.slim",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.48045 0.46        11779 2014-01-01   1        1\n2:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807",
        " 0.015739 -0.010518 0.542770 37.57267 3.56          184 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.57267 3.56          184 2014-10-01   0        2\n",
        "> ",
        "chr.trade_date",
        "[1] \"2014-01-06\"\n",
        "> ",
        "dt.portfolio.slim",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.48045 0.46        11779 2014-01-01   1        1\n2:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807",
        " 0.015739 -0.010518 0.542770 37.57267 3.56          184 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.57267 3.56          184 2014-10-01   0        2\n",
        "> ",
        "dt.portfolio.slim",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.48045 0.46        11779 2014-01-01   1        1\n2:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807",
        " 0.015739 -0.010518 0.542770 37.57267 3.56          184 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.57267 3.56          184 2014-10-01   0        2\n",
        "> ",
        "dt.portfolio.slim[qty==0]",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying    iv vol  delta    gamma     theta    vega      rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.131 184 0.2807 0.015739 -0.010518 0.54277 37.57267 3.56          184 2014-10-01   0        2\n",
        "> ",
        "dt.portfolio.slim[qty==0]$trade_id",
        "[1] 2\n",
        "> ",
        "dt.portfolio.slim <- dt.portfolio.slim[!trade_id %in% dt.portfolio.slim[qty==0]$trade_id]",
        "> ",
        "dt.portfolio.slim",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol delta    gamma     theta     vega     rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.213 0.084227 -0.035901 0.104252 1.48045 0.46        11779 2014-01-01   1        1\n",
        "> ",
        "updateMarks <- function(data=dt.spy,  dt.portfolio, chr.trade_date) {",
        "+ ",
        "  ",
        "+ ",
        "  dt.slim <- data[trade_date==chr.trade_date]",
        "+ ",
        "  dt.portfolio.slim <- dt.portfolio[trade_date == max(dt.portfolio$trade_date)]",
        "+ ",
        "  #remove closed trades",
        "+ ",
        "  dt.portfolio.slim <- dt.portfolio.slim[!trade_id %in% dt.portfolio.slim[qty==0]$trade_id]",
        "+ ",
        "  dt.update <- merge(dt.slim, dt.portfolio.slim[,list(symbol,trade_date=chr.trade_date, expiration, strike, call_put, qty, trade_id)], by=c('symbol','trade_date','expiration','strike','call_put'))",
        "+ ",
        "  dt.portfolio <- rbind(dt.portfolio, dt.update)",
        "+ ",
        "  return(dt.portfolio)",
        "+ ",
        "  ",
        "+ ",
        "  ",
        "+ ",
        "}",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "suppressWarnings(source('~/rPackageFunctions/toCreate.R'))",
        "> ",
        "suppressWarnings(source('~/rPackageFunctions/toCreateOptionFunctions.R'))",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-06  SPY 2014-10-18    195        c 3.17 3.24     182.41                   -12.59 0.1285    11 0.2650 0.015730 -0.010019 0.523246 35.101490",
        " 3.25           11 2014-10-01  -1        2\n8:    SPY 2014-01-06  SPY 2014-10-18    195        c 3.17 3.24     182.41                   -12.59 0.1285    11 0.2650 0.015730 -0.010019 0.523246 35.101490 3.25           11 2014-10-01   0        2\n",
        "> ",
        "dt.slim <- data[trade_date==chr.trade_date]",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n",
        "> ",
        "dt.slim <- data[trade_date==chr.trade_date]",
        "> ",
        "suppressWarnings(source('~/rPackageFunctions/toCreate.R'))",
        "> ",
        "suppressWarnings(source('~/rPackageFunctions/toCreateOptionFunctions.R'))",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n",
        "> ",
        "dt.portfolio[trade_id==1]",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740 1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130",
        " 0.084227 -0.035901 0.104252 1.480450 0.46        11779 2014-01-01   1        1\n3:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098 0.756688 0.21        22711 2014-01-01   1        1\n4:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610 1.067815 0.31        25780 2014-01-01   1        1\n",
        "> ",
        "tables()",
        "      NAME                 NROW NCOL MB COLS                                                                             KEY                    \n [1,] data              184,231   20 27 symbol,trade_date,root,expiration,strike,call_put,bid,ask,underlying,distance_fr                        \n [2,] dt.portfolio            7   22  1 symbol,trade_date,root,expiration,strike,call_put,bid,ask,underlying,distance_fr                        \n [3,] dt.portfolio.slim       1   22  1 symbol,trade_date,root,expiration,strike,call_put,bid,ask,underlying,distance_fr",
        "                        \n [4,] dt.pos1                 1   22  1 symbol,trade_date,root,expiration,strike,call_put,bid,ask,underlying,distance_fr                        \n [5,] dt.pos2                 1   22  1 symbol,trade_date,root,expiration,strike,call_put,bid,ask,underlying,distance_fr                        \n [6,] dt.positions            0    0  1                                                                                                         \n [7,] dt.slim               551   20  1 symbol,trade_date,root,expiration,strike,call_put,bid,ask,underlying,distance_fr",
        "                        \n [8,] dt.spy            184,231   20 27 symbol,trade_date,root,expiration,strike,call_put,bid,ask,underlying,distance_fr                        \n [9,] expirations           144    4  1 month,year,trade_volume,expiration                                               month,year,trade_volume\n[10,] f                       5   17  1 underlying_symbol,quote_date,expiration,strike,option_type,trade_volume,bid,ask,                        \n[11,] q                       1   22  1 symbol,trade_date,root,expiration,strike,call_put,bid,ask,underlying,distance_fr",
        "                        \nTotal: 63MB\n",
        "> ",
        "gc()",
        "          used (Mb) gc trigger  (Mb) max used  (Mb)\nNcells 1200874 64.2    2164898 115.7  1770749  94.6\nVcells 5307984 40.5   17944472 137.0 27897500 212.9\n",
        "> ",
        "gc()",
        "          used (Mb) gc trigger  (Mb) max used  (Mb)\nNcells 1200800 64.2    2164898 115.7  1770749  94.6\nVcells 5306354 40.5   17944472 137.0 27897500 212.9\n",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "library(DceSql)",
        "Error in library(DceSql) : there is no package called ‘DceSql’\n",
        "> ",
        "library(DceZn)",
        "Error in library(DceZn) : there is no package called ‘DceZn’\n",
        "> ",
        "DceZn:::.setLiveFilesystem(FALSE)",
        "Error in loadNamespace(name) : there is no package called ‘DceZn’\n",
        "> ",
        "source(paste0(getZnWd(),'/dce/dce/ppa/strategies/termR/run/DailyIntramonth.R'))",
        "Error in paste0(getZnWd(), \"/dce/dce/ppa/strategies/termR/run/DailyIntramonth.R\") : \n  could not find function \"getZnWd\"\n",
        "> ",
        "",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-07', chr.expiration='2014-01-18',chr.option_type = 'c',int.strike = 186)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        2\n",
        "> ",
        "updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-08')",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        2\n9:    SPY 2014-01-08  SPY 2014-01-18    186        c 0.26 0.27     183.64                    -2.36 0.0982  7708 0.1753 0.091275 -0.040388 0.074305  0.786347 0.29         7708 2014-01-01   1        1\n",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-07', chr.expiration='2014-01-18',chr.option_type = 'c',int.strike = 186)[,qty:=0][,trade_id:=1]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-08')",
        "Error in setnames(jval, jvnames) : \n  Can't assign 7 names to a 1 column data.table\n",
        "In addition: ",
        "Warning messages:\n",
        "1: ",
        "In as.data.table.list(jval) :",
        "\n ",
        " Item 1 is of size 0 but maximum size is 1, therefore recycled with 'NA'\n",
        "2: ",
        "In as.data.table.list(jval) :",
        "\n ",
        " Item 3 is of size 0 but maximum size is 1, therefore recycled with 'NA'\n",
        "3: ",
        "In as.data.table.list(jval) :",
        "\n ",
        " Item 4 is of size 0 but maximum size is 1, therefore recycled with 'NA'\n",
        "4: ",
        "In as.data.table.list(jval) :",
        "\n ",
        " Item 5 is of size 0 but maximum size is 1, therefore recycled with 'NA'\n",
        "5: ",
        "In as.data.table.list(jval) :",
        "\n ",
        " Item 6 is of size 0 but maximum size is 1, therefore recycled with 'NA'\n",
        "6: ",
        "In as.data.table.list(jval) :",
        "\n ",
        " Item 7 is of size 0 but maximum size is 1, therefore recycled with 'NA'\n",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "dt.slim <- data[trade_date==chr.trade_date]",
        "> ",
        "dt.portfolio.slim <- dt.portfolio[trade_date == max(dt.portfolio$trade_date)]",
        "> ",
        "#remove closed trades",
        "> ",
        "dt.portfolio.slim <- dt.portfolio.slim[!trade_id %in% dt.portfolio.slim[qty==0]$trade_id]",
        "> ",
        "dt.portfolio.slim",
        "Empty data.table (0 rows) of 22 cols: symbol,trade_date,root,expiration,strike,call_put...\n",
        "> ",
        "suppressWarnings(source('~/rPackageFunctions/toCreateOptionFunctions.R'))",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-07', chr.expiration='2014-01-18',chr.option_type = 'c',int.strike = 186)[,qty:=0][,trade_id:=1]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "",
        "> ",
        "updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-08')",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "pullForecast(getLstConn(), 194314, chr.aggregation='daily')[,mean(price), by=date]",
        "Error: could not find function \"pullForecast\"\n",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-08')",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-09')",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-07', chr.expiration='2014-01-18',chr.option_type = 'c',int.strike = 186)[,qty:=0][,trade_id:=1]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "mtm <- data.table()",
        "> ",
        "for ( j in unique(dt.positions$trade_id)) {",
        "+ ",
        "  temp <- dt.positions[trade_id == j][order(trade_date)]",
        "+ ",
        "  temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]",
        "+ ",
        "  temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]",
        "+ ",
        "  mtm <- rbind(mtm, temp)[order(trade_date)]",
        "+ ",
        "  ",
        "+ ",
        "}",
        "> ",
        "mtm",
        "Null data.table (0 rows and 0 cols)\n",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "mtm <- data.table()",
        "> ",
        "for ( j in unique(dt.portfolio$trade_id)) {",
        "+ ",
        "  temp <- dt.portfolio[trade_id == j][order(trade_date)]",
        "+ ",
        "  temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]",
        "+ ",
        "  temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]",
        "+ ",
        "  mtm <- rbind(mtm, temp)[order(trade_date)]",
        "+ ",
        "  ",
        "+ ",
        "}",
        "> ",
        "mtm",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id yest_ask  dmtm\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1       NA  0.00\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01",
        " 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2       NA  0.00\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1     0.50 -0.08\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01",
        "  -1        2    -3.42 -0.07\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2    -3.49  3.49\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1     0.42 -0.20\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34",
        " 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   1        1     0.22  0.13\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1     0.35 -0.35\n",
        "> ",
        "j <- 1",
        "> ",
        "temp <- dt.portfolio[trade_id == j][order(trade_date)]",
        "> ",
        "temp",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740 1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130",
        " 0.084227 -0.035901 0.104252 1.480450 0.46        11779 2014-01-01   1        1\n3:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098 0.756688 0.21        22711 2014-01-01   1        1\n4:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610 1.067815 0.31        25780 2014-01-01   1        1\n5:    SPY 2014-01-07  SPY 2014-01-18",
        "    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610 1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]",
        "> ",
        "temp",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume      strip qty trade_id yest_ask\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740 1.658009 0.63        18034 2014-01-01   1        1       NA\n2:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07",
        " 0.0962 11779 0.2130 0.084227 -0.035901 0.104252 1.480450 0.46        11779 2014-01-01   1        1     0.50\n3:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098 0.756688 0.21        22711 2014-01-01   1        1     0.42\n4:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610 1.067815 0.31        25780 2014-01-01   1        1",
        "     0.22\n5:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610 1.067815 0.31        25780 2014-01-01   0        1     0.35\n",
        "> ",
        "temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]",
        "> ",
        "temp",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume      strip qty trade_id yest_ask  dmtm\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740 1.658009 0.63        18034 2014-01-01   1        1       NA  0.00\n2:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07",
        " 0.0962 11779 0.2130 0.084227 -0.035901 0.104252 1.480450 0.46        11779 2014-01-01   1        1     0.50 -0.08\n3:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098 0.756688 0.21        22711 2014-01-01   1        1     0.42 -0.20\n4:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610 1.067815 0.31        25780 2014-01-01",
        "   1        1     0.22  0.13\n5:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610 1.067815 0.31        25780 2014-01-01   0        1     0.35 -0.35\n",
        "> ",
        "mtm",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id yest_ask  dmtm\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1       NA  0.00\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01",
        " 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2       NA  0.00\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1     0.50 -0.08\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01",
        "  -1        2    -3.42 -0.07\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2    -3.49  3.49\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1     0.42 -0.20\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34",
        " 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   1        1     0.22  0.13\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1     0.35 -0.35\n",
        "> ",
        "mtm <- data.table()",
        "> ",
        "for ( j in unique(dt.portfolio$trade_id)) {",
        "+ ",
        "  temp <- dt.portfolio[trade_id == j][qty!=0][order(trade_date)]",
        "+ ",
        "  temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]",
        "+ ",
        "  temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]",
        "+ ",
        "  mtm <- rbind(mtm, temp)[order(trade_date)]",
        "+ ",
        "  ",
        "+ ",
        "}",
        "> ",
        "mtm",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id yest_ask  dmtm\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1       NA  0.00\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01",
        " 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2       NA  0.00\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1     0.50 -0.08\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01",
        "  -1        2    -3.42 -0.07\n5:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1     0.42 -0.20\n6:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   1        1     0.22  0.13\n",
        "> ",
        "mtm[,sum(dmtm), by=trade_date]",
        "   trade_date    V1\n1: 2014-01-02  0.00\n2: 2014-01-03 -0.15\n3: 2014-01-06 -0.20\n4: 2014-01-07  0.13\n",
        "> ",
        "mtm[,sum(dmtm), by=trade_id]",
        "   trade_id    V1\n1:        1 -0.15\n2:        2 -0.07\n",
        "> ",
        "mtm[,sum(dmtm), by=trade_date]",
        "   trade_date    V1\n1: 2014-01-02  0.00\n2: 2014-01-03 -0.15\n3: 2014-01-06 -0.20\n4: 2014-01-07  0.13\n",
        "> ",
        "mtm[,sum(dmtm), by=trade_date][,sum(V1)]",
        "[1] -0.22\n",
        "> ",
        "mtm <- data.table()",
        "> ",
        "for ( j in unique(dt.portfolio$trade_id)) {",
        "+ ",
        "  temp <- dt.portfolio[trade_id == j][qty!=0][order(trade_date)]",
        "+ ",
        "  temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]",
        "+ ",
        "  temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]",
        "+ ",
        "  mtm <- rbind(mtm, temp)[order(trade_id, trade_date)]",
        "+ ",
        "  ",
        "+ ",
        "}",
        "> ",
        "mtm",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id yest_ask  dmtm\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1       NA  0.00\n2:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07",
        " 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1     0.50 -0.08\n3:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1     0.42 -0.20\n4:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01",
        "   1        1     0.22  0.13\n5:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2       NA  0.00\n6:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2    -3.42 -0.07\n",
        "> ",
        "getPortfolioMtm <- function(dt.portfolio) {",
        "+ ",
        "  ",
        "+ ",
        "  dt.mtm <- data.table()",
        "+ ",
        "  for ( j in unique(dt.portfolio$trade_id)) {",
        "+ ",
        "    temp <- dt.portfolio[trade_id == j][qty!=0][order(trade_date)]",
        "+ ",
        "    temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]",
        "+ ",
        "    temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]",
        "+ ",
        "    dt.mtm <- rbind(dt.mtm, temp)[order(trade_id, trade_date)]",
        "+ ",
        "    ",
        "+ ",
        "  }",
        "+ ",
        "  ",
        "+ ",
        "}",
        "> ",
        "getPortfolioMtm <- function(dt.portfolio) {",
        "+ ",
        "  ",
        "+ ",
        "  dt.mtm <- data.table()",
        "+ ",
        "  for ( j in unique(dt.portfolio$trade_id)) {",
        "+ ",
        "    temp <- dt.portfolio[trade_id == j][qty!=0][order(trade_date)]",
        "+ ",
        "    temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]",
        "+ ",
        "    temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]",
        "+ ",
        "    dt.mtm <- rbind(dt.mtm, temp)[order(trade_id, trade_date)]",
        "+ ",
        "    ",
        "+ ",
        "  }",
        "+ ",
        "  return(dt.mtm)",
        "+ ",
        "  ",
        "+ ",
        "}",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "getPortfolioMtm(getPortfolioMtm)",
        "Error in dt.portfolio$trade_id : \n  object of type 'closure' is not subsettable\n",
        "> ",
        "getPortfolioMtm(dt.portfolio)",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id yest_ask  dmtm\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1       NA  0.00\n2:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07",
        " 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1     0.50 -0.08\n3:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1     0.42 -0.20\n4:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01",
        "   1        1     0.22  0.13\n5:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2       NA  0.00\n6:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2    -3.42 -0.07\n",
        "> ",
        "getPortfolioMtm(dt.portfolio)[,sum(dmtm)]",
        "[1] -0.22\n",
        "> ",
        "getPortfolioMtm(dt.portfolio)[,sum(dmtm)]",
        "[1] -0.22\n",
        "> ",
        "getPortfolioMtm(getPortfolioMtm)",
        "Error in dt.portfolio$trade_id : \n  object of type 'closure' is not subsettable\n",
        "> ",
        "updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-09')",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "expirations",
        "     month year trade_volume expiration\n  1:     1 2005       339248 2005-01-22\n  2:     1 2006      2605639 2006-01-21\n  3:     1 2007      3407737 2007-01-20\n  4:     1 2008     15927956 2008-01-19\n  5:     1 2009     18855904 2009-01-17\n ---                                   \n140:    12 2013    284893920 2013-12-21\n141:    12 2014    144494189 2014-12-20\n142:    12 2015     52892595 2015-12-19\n143:    12 2016      2166879 2016-12-16\n144:    12 2017       447477 2017-12-15\n",
        "> ",
        "getExpirations <- function(connSettings=con) {",
        "+ ",
        "  ",
        "+ ",
        "  dt.expirations <- data.table(dbGetQuery(conn = connSettings,statement = 'select expiration, month(expiration) month, year(expiration) year, sum(trade_volume) trade_volume ",
        "+ ",
        "                                     from import_livevol.spy group by expiration  '))",
        "+ ",
        "  dt.expirations <-  merge(dt.expirations,dt.expirations[,list(trade_volume=max(trade_volume)), by=list(month,year)], by=c('month','year','trade_volume'))",
        "+ ",
        "  return(dt.expirations[,list(expiration)])",
        "+ ",
        "}",
        "> ",
        "getExpirations(con)",
        "     expiration\n  1: 2005-01-22\n  2: 2006-01-21\n  3: 2007-01-20\n  4: 2008-01-19\n  5: 2009-01-17\n ---           \n140: 2013-12-21\n141: 2014-12-20\n142: 2015-12-19\n143: 2016-12-16\n144: 2017-12-15\n",
        "Warning message:\n",
        "In .local(conn, statement, ...) :",
        "\n ",
        " Decimal MySQL column 3 imported as numeric\n",
        "> ",
        "getExpirations(con)",
        "     expiration\n  1: 2005-01-22\n  2: 2006-01-21\n  3: 2007-01-20\n  4: 2008-01-19\n  5: 2009-01-17\n ---           \n140: 2013-12-21\n141: 2014-12-20\n142: 2015-12-19\n143: 2016-12-16\n144: 2017-12-15\n",
        "Warning message:\n",
        "In .local(conn, statement, ...) :",
        "\n ",
        " Decimal MySQL column 3 imported as numeric\n",
        "> ",
        "expirations <- getExpirations(con)",
        "Warning message:\n",
        "In .local(conn, statement, ...) :",
        "\n ",
        " Decimal MySQL column 3 imported as numeric\n",
        "> ",
        "expirations",
        "     expiration\n  1: 2005-01-22\n  2: 2006-01-21\n  3: 2007-01-20\n  4: 2008-01-19\n  5: 2009-01-17\n ---           \n140: 2013-12-21\n141: 2014-12-20\n142: 2015-12-19\n143: 2016-12-16\n144: 2017-12-15\n",
        "> ",
        "dt.spy",
        "        symbol trade_date root expiration strike call_put   bid   ask underlying distance_from_underlying     iv vol   delta    gamma     theta     vega         rho  vwap trade_volume      strip\n     1:    SPY 2011-11-14  SPY 2014-01-18    125        c 17.33 17.60     125.72                     0.72 0.2680   5  0.6039 0.007758 -0.013510 0.714144  119.245772 17.63            5 2014-01-01\n     2:    SPY 2011-11-14  SPY 2014-01-18    125        p 21.23 21.49     125.72                    -0.72 0.2751  10 -0.3948",
        " 0.007552 -0.010516 0.713477 -147.985039 21.45           10 2014-01-01\n     3:    SPY 2011-11-14  SPY 2014-01-18    126        p 21.73 21.99     125.72                     0.28 0.2736   2 -0.4027 0.007632 -0.010476 0.717236 -151.109773 21.83            2 2014-01-01\n     4:    SPY 2011-11-14  SPY 2014-01-18    128        c 15.64 16.09     125.72                    -2.28 0.2618   5  0.5789 0.008060 -0.013371 0.724855  116.167868 16.00            5 2014-01-01\n     5:    SPY 2011-11-15  SPY 2014-01-18    120        c",
        " 20.75 21.06     125.96                     5.96 0.2784   1  0.6500 0.007133 -0.013659 0.690951  125.187759 20.72            1 2014-01-01\n    ---                                                                                                                                                                                           \n184227:    SPY 2014-12-19  SPY 2014-12-20    220        p 12.77 13.01     206.54                    13.46 0.0000 284 -0.9885 0.005564 -2.387516 0.000602   -0.020290 14.01          284",
        " 2014-12-01\n184228:    SPY 2014-12-19  SPY 2014-12-20    225        p 17.77 18.08     206.54                    18.46 0.0000  67 -0.9941 0.002477 -1.781587 0.000325   -0.019586 18.94           67 2014-12-01\n184229:    SPY 2014-12-19  SPY 2014-12-20    230        p 22.77 23.08     206.54                    23.46 0.0000  18 -0.9943 0.001898 -2.151395 0.000313   -0.020028 23.57           18 2014-12-01\n184230:    SPY 2014-12-19  SPY 2014-12-20    235        p 27.77 28.08     206.54                    28.46 0.0000",
        "  10 -0.9953 0.001371 -2.140990 0.000265   -0.020483 29.00           10 2014-12-01\n184231:    SPY 2014-12-19  SPY 2014-12-20    255        p 47.75 48.09     206.54                    48.46 7.5010   1 -0.9985 0.000343 -1.132106 0.000095   -0.021806 48.80            1 2014-12-01\n",
        "> ",
        "dt.spy",
        "        symbol trade_date root expiration strike call_put   bid   ask underlying distance_from_underlying     iv vol   delta    gamma     theta     vega         rho  vwap trade_volume      strip\n     1:    SPY 2011-11-14  SPY 2014-01-18    125        c 17.33 17.60     125.72                     0.72 0.2680   5  0.6039 0.007758 -0.013510 0.714144  119.245772 17.63            5 2014-01-01\n     2:    SPY 2011-11-14  SPY 2014-01-18    125        p 21.23 21.49     125.72                    -0.72 0.2751  10 -0.3948",
        " 0.007552 -0.010516 0.713477 -147.985039 21.45           10 2014-01-01\n     3:    SPY 2011-11-14  SPY 2014-01-18    126        p 21.73 21.99     125.72                     0.28 0.2736   2 -0.4027 0.007632 -0.010476 0.717236 -151.109773 21.83            2 2014-01-01\n     4:    SPY 2011-11-14  SPY 2014-01-18    128        c 15.64 16.09     125.72                    -2.28 0.2618   5  0.5789 0.008060 -0.013371 0.724855  116.167868 16.00            5 2014-01-01\n     5:    SPY 2011-11-15  SPY 2014-01-18    120        c",
        " 20.75 21.06     125.96                     5.96 0.2784   1  0.6500 0.007133 -0.013659 0.690951  125.187759 20.72            1 2014-01-01\n    ---                                                                                                                                                                                           \n184227:    SPY 2014-12-19  SPY 2014-12-20    220        p 12.77 13.01     206.54                    13.46 0.0000 284 -0.9885 0.005564 -2.387516 0.000602   -0.020290 14.01          284",
        " 2014-12-01\n184228:    SPY 2014-12-19  SPY 2014-12-20    225        p 17.77 18.08     206.54                    18.46 0.0000  67 -0.9941 0.002477 -1.781587 0.000325   -0.019586 18.94           67 2014-12-01\n184229:    SPY 2014-12-19  SPY 2014-12-20    230        p 22.77 23.08     206.54                    23.46 0.0000  18 -0.9943 0.001898 -2.151395 0.000313   -0.020028 23.57           18 2014-12-01\n184230:    SPY 2014-12-19  SPY 2014-12-20    235        p 27.77 28.08     206.54                    28.46 0.0000",
        "  10 -0.9953 0.001371 -2.140990 0.000265   -0.020483 29.00           10 2014-12-01\n184231:    SPY 2014-12-19  SPY 2014-12-20    255        p 47.75 48.09     206.54                    48.46 7.5010   1 -0.9985 0.000343 -1.132106 0.000095   -0.021806 48.80            1 2014-12-01\n",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume      strip qty trade_id\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034 2014-01-01   1        1\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773",
        " 0.015724 -0.010416 0.540075 37.236314 3.53           82 2014-10-01  -1        2\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779 2014-01-01   1        1\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01  -1        2\n5:    SPY 2014-01-03  SPY 2014-10-18",
        "    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184 2014-10-01   0        2\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711 2014-01-01   1        1\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780 2014-01-01   1        1\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780 2014-01-01   0        1\n",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82",
        "\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56",
        "          184\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n3: 2014-01-01   1        1\n4: 2014-10-01  -1        2\n5: 2014-10-01   0        2\n6: 2014-01-01   1        1\n7: 2014-01-01   1        1\n8: 2014-01-01   0        1\n",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.5     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.5     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82",
        "\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82",
        "\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56",
        "          184\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n3: 2014-01-01   1        1\n4: 2014-10-01  -1        2\n5: 2014-10-01   0        2\n6: 2014-01-01   1        1\n",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-07', chr.expiration='2014-01-18',chr.option_type = 'c',int.strike = 186)[,qty:=0][,trade_id:=1]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82",
        "\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56",
        "          184\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711\n7:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815 0.31        25780\n8:    SPY 2014-01-07  SPY 2014-01-18    186        c 0.34 0.35     183.41                    -2.59 0.0942 25780 0.2140 0.101751 -0.041870 0.088610  1.067815",
        " 0.31        25780\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n3: 2014-01-01   1        1\n4: 2014-10-01  -1        2\n5: 2014-10-01   0        2\n6: 2014-01-01   1        1\n7: 2014-01-01   1        1\n8: 2014-01-01   0        1\n",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82",
        "\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56",
        "          184\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n3: 2014-01-01   1        1\n4: 2014-10-01  -1        2\n5: 2014-10-01   0        2\n6: 2014-01-01   1        1\n",
        "> ",
        "getBestOption(data=dt.spy, chr.trade_date = '2014-01-03',chr.expiration = '2014-01-18', chr.option_type = 'c',int.min_delta = .5)",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega     rho vwap trade_volume\n1:    SPY 2014-01-03  SPY 2014-01-18    184        c 1.11 1.12     182.93                    -1.07 0.1033 20376 0.4186 0.105439 -0.051818 0.140109 2.89745 1.19        20376\n        strip\n1: 2014-01-01\n",
        "> ",
        "getBestOption(data=dt.spy, chr.trade_date = '2014-01-03',chr.expiration = '2014-01-18', chr.option_type = 'c',int.min_delta = .51)",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega     rho vwap trade_volume\n1:    SPY 2014-01-03  SPY 2014-01-18    184        c 1.11 1.12     182.93                    -1.07 0.1033 20376 0.4186 0.105439 -0.051818 0.140109 2.89745 1.19        20376\n        strip\n1: 2014-01-01\n",
        "> ",
        "getBestOption(data=dt.spy, chr.trade_date = '2014-01-03',chr.expiration = '2014-01-18', chr.option_type = 'c',int.min_delta = .55)",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume\n1:    SPY 2014-01-03  SPY 2014-01-18    183        c 1.64 1.65     182.93                    -0.07 0.1079 26107 0.5248 0.102882 -0.055203 0.142818 3.622872 1.71        26107\n        strip\n1: 2014-01-01\n",
        "> ",
        "getBestOption(data=dt.spy, chr.trade_date = '2014-01-03',chr.expiration = '2014-01-18', chr.option_type = 'c',chr.money_in_out = 'out',int.min_dollar = 0)",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume\n1:    SPY 2014-01-03  SPY 2014-01-18    183        c 1.64 1.65     182.93                    -0.07 0.1079 26107 0.5248 0.102882 -0.055203 0.142818 3.622872 1.71        26107\n        strip\n1: 2014-01-01\n",
        "> ",
        "getBestOption(data=dt.spy, chr.trade_date = '2014-01-03',chr.expiration = '2014-02-22', chr.option_type = 'c',chr.money_in_out = 'out',int.min_dollar = 0)",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying    iv  vol  delta    gamma     theta     vega      rho vwap trade_volume\n1:    SPY 2014-01-03  SPY 2014-02-22    183        c 3.34 3.37     182.93                    -0.07 0.121 7387 0.5204 0.049089 -0.033451 0.267148 12.32343 3.45         7387\n        strip\n1: 2014-02-01\n",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82",
        "\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56",
        "          184\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n3: 2014-01-01   1        1\n4: 2014-10-01  -1        2\n5: 2014-10-01   0        2\n6: 2014-01-01   1        1\n",
        "> ",
        "expirations",
        "     expiration\n  1: 2005-01-22\n  2: 2006-01-21\n  3: 2007-01-20\n  4: 2008-01-19\n  5: 2009-01-17\n ---           \n140: 2013-12-21\n141: 2014-12-20\n142: 2015-12-19\n143: 2016-12-16\n144: 2017-12-15\n",
        "> ",
        "expirations[expiration>chr.trade_date]",
        "    expiration\n 1: 2014-01-18\n 2: 2015-01-17\n 3: 2016-01-15\n 4: 2017-01-20\n 5: 2018-01-19\n 6: 2014-02-22\n 7: 2015-02-20\n 8: 2016-02-19\n 9: 2014-03-22\n10: 2015-03-20\n11: 2016-03-18\n12: 2017-03-17\n13: 2014-04-19\n14: 2015-04-17\n15: 2014-05-17\n16: 2015-05-15\n17: 2014-06-21\n18: 2015-06-19\n19: 2016-06-17\n20: 2017-06-16\n21: 2014-07-19\n22: 2015-07-17\n23: 2014-08-16\n24: 2015-08-21\n25: 2014-09-20\n26: 2015-09-18\n27: 2016-09-16\n28: 2017-09-15\n29: 2014-10-18\n30: 2015-10-16\n31: 2014-11-22\n32: 2015-11-20\n33: 2014-12-20\n34:",
        " 2015-12-19\n35: 2016-12-16\n36: 2017-12-15\n    expiration\n",
        "> ",
        "expirations[expiration>chr.trade_date][order(expiration)]",
        "    expiration\n 1: 2014-01-18\n 2: 2014-02-22\n 3: 2014-03-22\n 4: 2014-04-19\n 5: 2014-05-17\n 6: 2014-06-21\n 7: 2014-07-19\n 8: 2014-08-16\n 9: 2014-09-20\n10: 2014-10-18\n11: 2014-11-22\n12: 2014-12-20\n13: 2015-01-17\n14: 2015-02-20\n15: 2015-03-20\n16: 2015-04-17\n17: 2015-05-15\n18: 2015-06-19\n19: 2015-07-17\n20: 2015-08-21\n21: 2015-09-18\n22: 2015-10-16\n23: 2015-11-20\n24: 2015-12-19\n25: 2016-01-15\n26: 2016-02-19\n27: 2016-03-18\n28: 2016-06-17\n29: 2016-09-16\n30: 2016-12-16\n31: 2017-01-20\n32: 2017-03-17\n33: 2017-06-16\n34:",
        " 2017-09-15\n35: 2017-12-15\n36: 2018-01-19\n    expiration\n",
        "> ",
        "expirations[expiration>chr.trade_date][order(expiration)][1,]",
        "   expiration\n1: 2014-01-18\n",
        "> ",
        "dt.atm <- getBestOption(data=dt.spy, ",
        "+ ",
        "                          chr.trade_date = chr.trade_date,",
        "+ ",
        "                          chr.expiration =expirations[expiration>chr.trade_date][order(expiration)][1,]$expiration,",
        "+ ",
        "                          chr.option_type = 'c',",
        "+ ",
        "                          chr.money_in_out = 'out',",
        "+ ",
        "                          int.min_dollar = 0)",
        "> ",
        "dt.atm",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume\n1:    SPY 2014-01-06  SPY 2014-01-18    183        c 1.14 1.16     182.41                    -0.59 0.1049 30893 0.4575 0.119317 -0.060281 0.125756 2.483365 1.25        30893\n        strip\n1: 2014-01-01\n",
        "> ",
        "int.vol <- dt.atm$iv",
        "> ",
        "dt.atm",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume\n1:    SPY 2014-01-06  SPY 2014-01-18    183        c 1.14 1.16     182.41                    -0.59 0.1049 30893 0.4575 0.119317 -0.060281 0.125756 2.483365 1.25        30893\n        strip\n1: 2014-01-01\n",
        "> ",
        "chr.trade_date",
        "[1] \"2014-01-06\"\n",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82",
        "\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56",
        "          184\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n3: 2014-01-01   1        1\n4: 2014-10-01  -1        2\n5: 2014-10-01   0        2\n6: 2014-01-01   1        1\n",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82",
        "\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56",
        "          184\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n3: 2014-01-01   1        1\n4: 2014-10-01  -1        2\n5: 2014-10-01   0        2\n6: 2014-01-01   1        1\n",
        "> ",
        "int.vol <- dt.atm$iv",
        "> ",
        "int.underlying <- dt.atm$underlying",
        "> ",
        "dt.portfolio[,sum(qty*delta)*100]",
        "[1] 1.69\n",
        "> ",
        "int.current_gamma <- dt.portfolio",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82",
        "\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56",
        "          184\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n3: 2014-01-01   1        1\n4: 2014-10-01  -1        2\n5: 2014-10-01   0        2\n6: 2014-01-01   1        1\n",
        "> ",
        "dt.portfolio[trade_date==chr.trade_date]",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume\n1:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098 0.756688 0.21        22711\n        strip qty trade_id\n1: 2014-01-01   1        1\n",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "chr.trade_date <- '2014-01-03'",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82",
        "\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56",
        "          184\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n3: 2014-01-01   1        1\n4: 2014-10-01  -1        2\n5: 2014-10-01   0        2\n",
        "> ",
        "dt.portfolio.slim <- dt.portfolio[trade_date==chr.trade_date]",
        "> ",
        "dt.portfolio.slim",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega      rho vwap trade_volume\n1:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.48045 0.46        11779\n2:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.57267 3.56          184",
        "\n3:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.57267 3.56          184\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n3: 2014-10-01   0        2\n",
        "> ",
        "dt.portfolio.slim <- dt.portfolio.slim[!trade_id %in% dt.portfolio.slim[qty==0]$trade_id]",
        "> ",
        "dt.portfolio.slim",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol delta    gamma     theta     vega     rho vwap trade_volume\n1:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.213 0.084227 -0.035901 0.104252 1.48045 0.46        11779\n        strip qty trade_id\n1: 2014-01-01   1        1\n",
        "> ",
        "int.current_delta <- dt.portfolio[,sum(qty*delta)*100]",
        "> ",
        "int.current_delta",
        "[1] -12.17\n",
        "> ",
        "int.current_gamma <- dt.portfolio[,sum(qty*gamma)*100]",
        "> ",
        "int.current_gamma",
        "[1] 12.93\n",
        "> ",
        "int.oneSDmove <- int.underlying*(int.vol)*(sqrt(1/365))",
        "> ",
        "int.oneSDmove",
        "[1] 1.001562\n",
        "> ",
        "int.range_gamma <- abs(int.oneSDmove * (int.current_gamma)/2 )",
        "> ",
        "int.range_gamma",
        "[1] 6.475096\n",
        "> ",
        "int.range_gamma",
        "[1] 6.475096\n",
        "> ",
        "int.current_delta",
        "[1] -12.17\n",
        "> ",
        "list(current_delta = int.current_delta, range_gamma=int.range_gamma)",
        "$current_delta\n[1] -12.17\n\n$range_gamma\n[1] 6.475096\n\n",
        "> ",
        "ls.metrics <- list(current_delta = int.current_delta, range_gamma=int.range_gamma)",
        "> ",
        "getRangeAcceptableDelta <- function(data=dt.spy, chr.trade_date, dt.portfolio) {",
        "+ ",
        "  ",
        "+ ",
        "  dt.atm <- getBestOption(data=dt.spy, ",
        "+ ",
        "                          chr.trade_date = chr.trade_date,",
        "+ ",
        "                          chr.expiration =expirations[expiration>chr.trade_date][order(expiration)][1,]$expiration,",
        "+ ",
        "                          chr.option_type = 'c',",
        "+ ",
        "                          chr.money_in_out = 'out',",
        "+ ",
        "                          int.min_dollar = 0)",
        "+ ",
        "  ",
        "+ ",
        "  int.vol <- dt.atm$iv",
        "+ ",
        "  int.underlying <- dt.atm$underlying",
        "+ ",
        "  dt.portfolio.slim <- dt.portfolio[trade_date==chr.trade_date]",
        "+ ",
        "  dt.portfolio.slim <- dt.portfolio.slim[!trade_id %in% dt.portfolio.slim[qty==0]$trade_id]",
        "+ ",
        "  int.current_delta <- dt.portfolio[,sum(qty*delta)*100]",
        "+ ",
        "  int.current_gamma <- dt.portfolio[,sum(qty*gamma)*100]",
        "+ ",
        "  int.oneSDmove <- int.underlying*(int.vol)*(sqrt(1/365))",
        "+ ",
        "  int.range_gamma <- abs(int.oneSDmove * (int.current_gamma)/2 )",
        "+ ",
        "  ls.metrics <- list(current_delta = int.current_delta, range_gamma=int.range_gamma)",
        "+ ",
        "  return(ls.metrics)",
        "+ ",
        "  ",
        "+ ",
        "  ",
        "+ ",
        "}",
        "> ",
        "suppressWarnings(source('~/rPackageFunctions/toCreate.R'))",
        "> ",
        "suppressWarnings(source('~/rPackageFunctions/toCreateOptionFunctions.R'))",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "dt.portfolio",
        "   symbol trade_date root expiration strike call_put  bid  ask underlying distance_from_underlying     iv   vol  delta    gamma     theta     vega       rho vwap trade_volume\n1:    SPY 2014-01-02  SPY 2014-01-18    186        c 0.49 0.50     182.99                    -3.01 0.1052 18034 0.2233 0.076536 -0.038541 0.110740  1.658009 0.63        18034\n2:    SPY 2014-01-02  SPY 2014-10-18    195        c 3.42 3.50     182.99                   -12.01 0.1303    82 0.2773 0.015724 -0.010416 0.540075 37.236314 3.53           82",
        "\n3:    SPY 2014-01-03  SPY 2014-01-18    186        c 0.41 0.42     182.93                    -3.07 0.0962 11779 0.2130 0.084227 -0.035901 0.104252  1.480450 0.46        11779\n4:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56          184\n5:    SPY 2014-01-03  SPY 2014-10-18    195        c 3.49 3.57     182.93                   -12.07 0.1310   184 0.2807 0.015739 -0.010518 0.542770 37.572665 3.56",
        "          184\n6:    SPY 2014-01-06  SPY 2014-01-18    186        c 0.21 0.22     182.41                    -3.59 0.0969 22711 0.1386 0.071949 -0.030992 0.070098  0.756688 0.21        22711\n        strip qty trade_id\n1: 2014-01-01   1        1\n2: 2014-10-01  -1        2\n3: 2014-01-01   1        1\n4: 2014-10-01  -1        2\n5: 2014-10-01   0        2\n6: 2014-01-01   1        1\n",
        "> ",
        "getRangeAcceptableDelta(chr.trade_date = '2014-01-06', dt.portfolio = dt.portfolio)",
        "$current_delta\n[1] 1.69\n\n$range_gamma\n[1] 10.07816\n\n",
        "> ",
        "suppressWarnings(source('~/rPackageFunctions/toCreate.R'))",
        "> ",
        "suppressWarnings(source('~/rPackageFunctions/toCreateOptionFunctions.R'))",
        "> ",
        "dt.portfolio <- rbind(dt.pos1, dt.pos2)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')",
        "> ",
        "q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]",
        "> ",
        "dt.portfolio <- rbind(dt.portfolio, q)",
        "> ",
        "dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')",
        "> ",
        "getRangeAcceptableDelta(chr.trade_date = '2014-01-06', dt.portfolio = dt.portfolio)",
        "$current_delta\n[1] 13.86\n\n$range_delta\n[1] 3.603068\n\n"
    ],
    "type" : [
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        2,
        0,
        1,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        2,
        0,
        1,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        2,
        2,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        3,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        3,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        3,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        3,
        3,
        3,
        3,
        0,
        1,
        2,
        3,
        3,
        3,
        3,
        0,
        1,
        3,
        3,
        3,
        3,
        0,
        1,
        2,
        0,
        1,
        2,
        2,
        2,
        2,
        2,
        0,
        1,
        2,
        2,
        2,
        2,
        2,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        2,
        0,
        1,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        2,
        2,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2
    ]
}