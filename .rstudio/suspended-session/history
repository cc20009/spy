describeCache(chr.location) {
chr.directory <- list.files(paste0('/home/ubuntu/cache/', chr.location))
return(chr.directory)
}
paste0('/home/ubuntu/cache/', chr.location)
chr.directory <- list.files(paste0('/home/ubuntu/cache/', chr.location))
return(chr.directory)
describeCache(chr.location) {
chr.directory <- list.files(paste0('/home/ubuntu/cache/', chr.location))
return(chr.directory)
}
describeCache <- function(chr.location) {
chr.directory <- list.files(paste0('/home/ubuntu/cache/', chr.location))
return(chr.directory)
}
describeCache()
describeCache('')
describeCache('spy_options/')
# improved list of objects
.ls.objects <- function (pos = 1, pattern, order.by,
decreasing=FALSE, head=FALSE, n=5) {
napply <- function(names, fn) sapply(names, function(x)
fn(get(x, pos = pos)))
names <- ls(pos = pos, pattern = pattern)
obj.class <- napply(names, function(x) as.character(class(x))[1])
obj.mode <- napply(names, mode)
obj.type <- ifelse(is.na(obj.class), obj.mode, obj.class)
obj.size <- napply(names, object.size)
obj.dim <- t(napply(names, function(x)
as.numeric(dim(x))[1:2]))
vec <- is.na(obj.dim)[, 1] & (obj.type != "function")
obj.dim[vec, 1] <- napply(names, length)[vec]
out <- data.frame(obj.type, obj.size, obj.dim)
names(out) <- c("Type", "Size", "Rows", "Columns")
if (!missing(order.by))
out <- out[order(out[[order.by]], decreasing=decreasing), ]
if (head)
out <- head(out, n)
out
}
# shorthand
lsos <- function(..., n=10) {
.ls.objects(..., order.by="Size", decreasing=TRUE, head=TRUE, n=n)
}
lsos
lsos()
source('~/rPackageFunctions/toCreate.R')
supressWarnings(source('~/rPackageFunctions/toCreate.R'))
surpressWarnings(source('~/rPackageFunctions/toCreate.R'))
supressWarnings(source('~/rPackageFunctions/toCreate.R'))
suppressWarnings(source('~/rPackageFunctions/toCreate.R'))
dt.spy <- getCachedObject(chr.location = 'spy_options/', chr.name='spy_2014')
dt.spy <- getCachedObject(chr.location = 'spy_options/', chr.name='spy_2014')
suppressWarnings(source('~/rPackageFunctions/toCreate.R'))
dt.spy <- getCachedObject(chr.location = 'spy_options/', chr.name='spy_2014')
dt.spy
suppressWarnings(source('~/rPackageFunctions/toCreate.R'))
f <- data.table(dbGetQuery(con, 'select * from tradeking.spy limit 5'))
f
dt.spy
class(dt.spy$symbol)
organizeDataTradeking <- function(dt) {
dt <-  dt[,list(symbol=underlying_symbol,
trade_date=as.character(quote_date),
root=underlying_symbol,
expiration=as.character(expiration),
strike,
call_put=option_type,
bid,
ask,
underlying = underlying_ask,
distance_from_underlying = ifelse(option_type=='c', underlying_ask - strike, strike- underlying_ask),
iv = implied_volatility_1545,
vol = trade_volume,
delta,
gamma,
theta,
vega,
rho,
vwap,
trade_volume,
strip=paste0(substring(expiration,1,8),'01'))]
return(dt)
}
organizeDataTradeking((f))
organizeDataTradeking <- function(dt) {
dt <-  dt[,list(symbol=underlying_symbol,
trade_date=as.character(quote_date),
root=underlying_symbol,
expiration=as.character(expiration),
strike,
call_put=option_type,
bid,
ask,
underlying = underlying_ask,
distance_from_underlying = ifelse(option_type=='c', underlying_ask - strike, strike- underlying_ask),
iv = implied_volatility,
vol = trade_volume,
delta,
gamma,
theta,
vega,
rho,
vwap,
trade_volume,
strip=paste0(substring(expiration,1,8),'01'))]
return(dt)
}
organizeDataTradeking((f))
dt.spy <- data.table(dbGetQuery(conn = con,statement = paste0("select * from import_livevol.spy
where vwap > 0 and year(expiration) = ",i," and expiration in (",
paste("'",as.character(expirations$expiration),"'",
collapse=", ",sep=""), ") "  )))
i <- 2005
dt.spy <- data.table(dbGetQuery(conn = con,statement = paste0("select * from import_livevol.spy
where vwap > 0 and year(expiration) = ",i," and expiration in (",
paste("'",as.character(expirations$expiration),"'",
collapse=", ",sep=""), ") "  )))
from import_livevol.spy group by expiration  '))
expirations <- data.table(dbGetQuery(conn = con,statement = 'select expiration, month(expiration) month, year(expiration) year, sum(trade_volume) trade_volume
expirations <-  merge(expirations,expirations[,list(trade_volume=max(trade_volume)), by=list(month,year)], by=c('month','year','trade_volume'))
expirations <- data.table(dbGetQuery(conn = con,statement = 'select expiration, month(expiration) month, year(expiration) year, sum(trade_volume) trade_volume
from import_livevol.spy group by expiration  '))
expirations <-  merge(expirations,expirations[,list(trade_volume=max(trade_volume)), by=list(month,year)], by=c('month','year','trade_volume'))
dt.spy <- data.table(dbGetQuery(conn = con,statement = paste0("select * from import_livevol.spy
where vwap > 0 and year(expiration) = ",i," and expiration in (",
paste("'",as.character(expirations$expiration),"'",
collapse=", ",sep=""), ") "  )))
dt.spy
suppressWarnings(source('~/rPackageFunctions/toCreate.R'))
for (i in 2005:2015) {
dt.spy <- data.table(dbGetQuery(conn = con,statement = paste0("select * from import_livevol.spy
where vwap > 0 and year(expiration) = ",i," and expiration in (",
paste("'",as.character(expirations$expiration),"'",
collapse=", ",sep=""), ") "  )))
dt.spy <- organizeData(dt.spy)
cacheObject(mxt.data = dt.spy, chr.location= 'spy_options/', chr.name = paste0('spy_',i))
}
dt.spy <- getCachedOpbject('spy_options/')
dt.spy <- getCachedOpbject('spy_options/spy_2015')
dt.spy <- getCachedObject('spy_options/spy_2015')
dt.spy <- getCachedObject('spy_options/','spy_2014')
dt.spy
dt.spy
dt.spy
dt.positions <- data.table()
dt.pos1 <- getBestOption(data=dt.spy,chr.trade_date = '2014-01-02',
chr.expiration = '2014-01-18', chr.option_type = 'c',int.min_delta = .3)[,qty:=1]
dt.pos1[,trade_id:=1]
dt.pos2 <- getBestOption(data=dt.spy,chr.trade_date = '2014-01-02',
chr.expiration = '2014-10-18', chr.option_type = 'c',int.min_delta = .3)[,qty:=-1]
dt.pos2[,trade_id:=2]
dt.portfolio <- rbind(dt.pos1, dt.pos2)
suppressWarnings(source('~/rPackageFunctions/toCreate.R'))
suppressWarnings(source('~/rPackageFunctions/toCreateOptionFunctions.R'))
dt.pos1 <- getBestOption(data=dt.spy,chr.trade_date = '2014-01-02',
chr.expiration = '2014-01-18', chr.option_type = 'c',int.min_delta = .3)[,qty:=1]
dt.pos1[,trade_id:=1]
dt.pos2 <- getBestOption(data=dt.spy,chr.trade_date = '2014-01-02',
chr.expiration = '2014-10-18', chr.option_type = 'c',int.min_delta = .3)[,qty:=-1]
dt.pos2[,trade_id:=2]
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio
updateMarks()
updateMarks(
updateMarks
updateMarks
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
dt.portfolio
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-04')
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-05')
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-04')
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
dt.portfolio
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
dt.portfolio
getBestOption('2014-01-03')
getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0]
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id=2]
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
q
q
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
data=dt.spy
dt.portfolio
chr.trade_date <- '2014-01-06'
dt.slim <- data[trade_date==chr.trade_date]
dt.slim
dt.portfolio[trade_date == max(dt.portfolio$trade_date)]
dt.portfolio.slim <- dt.portfolio[trade_date == max(dt.portfolio$trade_date)]
dt.portfolio.slim
chr.trade_date
dt.portfolio.slim
dt.portfolio.slim
dt.portfolio.slim[qty==0]
dt.portfolio.slim[qty==0]$trade_id
dt.portfolio.slim <- dt.portfolio.slim[!trade_id %in% dt.portfolio.slim[qty==0]$trade_id]
dt.portfolio.slim
updateMarks <- function(data=dt.spy,  dt.portfolio, chr.trade_date) {
dt.slim <- data[trade_date==chr.trade_date]
dt.portfolio.slim <- dt.portfolio[trade_date == max(dt.portfolio$trade_date)]
#remove closed trades
dt.portfolio.slim <- dt.portfolio.slim[!trade_id %in% dt.portfolio.slim[qty==0]$trade_id]
dt.update <- merge(dt.slim, dt.portfolio.slim[,list(symbol,trade_date=chr.trade_date, expiration, strike, call_put, qty, trade_id)], by=c('symbol','trade_date','expiration','strike','call_put'))
dt.portfolio <- rbind(dt.portfolio, dt.update)
return(dt.portfolio)
}
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
suppressWarnings(source('~/rPackageFunctions/toCreate.R'))
suppressWarnings(source('~/rPackageFunctions/toCreateOptionFunctions.R'))
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio
dt.slim <- data[trade_date==chr.trade_date]
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio
dt.slim <- data[trade_date==chr.trade_date]
suppressWarnings(source('~/rPackageFunctions/toCreate.R'))
suppressWarnings(source('~/rPackageFunctions/toCreateOptionFunctions.R'))
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')
dt.portfolio
dt.portfolio[trade_id==1]
tables()
gc()
gc()
library(DceSql)
library(DceZn)
DceZn:::.setLiveFilesystem(FALSE)
source(paste0(getZnWd(),'/dce/dce/ppa/strategies/termR/run/DailyIntramonth.R'))
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')
dt.portfolio
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-07', chr.expiration='2014-01-18',chr.option_type = 'c',int.strike = 186)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-08')
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-07', chr.expiration='2014-01-18',chr.option_type = 'c',int.strike = 186)[,qty:=0][,trade_id:=1]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-08')
dt.portfolio
dt.slim <- data[trade_date==chr.trade_date]
dt.portfolio.slim <- dt.portfolio[trade_date == max(dt.portfolio$trade_date)]
#remove closed trades
dt.portfolio.slim <- dt.portfolio.slim[!trade_id %in% dt.portfolio.slim[qty==0]$trade_id]
dt.portfolio.slim
suppressWarnings(source('~/rPackageFunctions/toCreateOptionFunctions.R'))
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-07', chr.expiration='2014-01-18',chr.option_type = 'c',int.strike = 186)[,qty:=0][,trade_id:=1]
dt.portfolio <- rbind(dt.portfolio, q)
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-08')
dt.portfolio
pullForecast(getLstConn(), 194314, chr.aggregation='daily')[,mean(price), by=date]
dt.portfolio
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-08')
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-09')
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-07', chr.expiration='2014-01-18',chr.option_type = 'c',int.strike = 186)[,qty:=0][,trade_id:=1]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio
mtm <- data.table()
for ( j in unique(dt.positions$trade_id)) {
temp <- dt.positions[trade_id == j][order(trade_date)]
temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]
temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]
mtm <- rbind(mtm, temp)[order(trade_date)]
}
mtm
dt.portfolio
mtm <- data.table()
for ( j in unique(dt.portfolio$trade_id)) {
temp <- dt.portfolio[trade_id == j][order(trade_date)]
temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]
temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]
mtm <- rbind(mtm, temp)[order(trade_date)]
}
mtm
j <- 1
temp <- dt.portfolio[trade_id == j][order(trade_date)]
temp
temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]
temp
temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]
temp
mtm
mtm <- data.table()
for ( j in unique(dt.portfolio$trade_id)) {
temp <- dt.portfolio[trade_id == j][qty!=0][order(trade_date)]
temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]
temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]
mtm <- rbind(mtm, temp)[order(trade_date)]
}
mtm
mtm[,sum(dmtm), by=trade_date]
mtm[,sum(dmtm), by=trade_id]
mtm[,sum(dmtm), by=trade_date]
mtm[,sum(dmtm), by=trade_date][,sum(V1)]
mtm <- data.table()
for ( j in unique(dt.portfolio$trade_id)) {
temp <- dt.portfolio[trade_id == j][qty!=0][order(trade_date)]
temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]
temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]
mtm <- rbind(mtm, temp)[order(trade_id, trade_date)]
}
mtm
getPortfolioMtm <- function(dt.portfolio) {
dt.mtm <- data.table()
for ( j in unique(dt.portfolio$trade_id)) {
temp <- dt.portfolio[trade_id == j][qty!=0][order(trade_date)]
temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]
temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]
dt.mtm <- rbind(dt.mtm, temp)[order(trade_id, trade_date)]
}
}
getPortfolioMtm <- function(dt.portfolio) {
dt.mtm <- data.table()
for ( j in unique(dt.portfolio$trade_id)) {
temp <- dt.portfolio[trade_id == j][qty!=0][order(trade_date)]
temp[,yest_ask:=c(NA, temp[,ifelse(qty>0, ask, bid)*qty][-nrow(temp)])]
temp[,dmtm:=ifelse(is.na(yest_ask) == T, 0,ifelse(qty>0, ask, bid)*qty-yest_ask)]
dt.mtm <- rbind(dt.mtm, temp)[order(trade_id, trade_date)]
}
return(dt.mtm)
}
dt.portfolio
getPortfolioMtm(getPortfolioMtm)
getPortfolioMtm(dt.portfolio)
getPortfolioMtm(dt.portfolio)[,sum(dmtm)]
getPortfolioMtm(dt.portfolio)[,sum(dmtm)]
getPortfolioMtm(getPortfolioMtm)
updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-09')
dt.portfolio
expirations
getExpirations <- function(connSettings=con) {
dt.expirations <- data.table(dbGetQuery(conn = connSettings,statement = 'select expiration, month(expiration) month, year(expiration) year, sum(trade_volume) trade_volume
from import_livevol.spy group by expiration  '))
dt.expirations <-  merge(dt.expirations,dt.expirations[,list(trade_volume=max(trade_volume)), by=list(month,year)], by=c('month','year','trade_volume'))
return(dt.expirations[,list(expiration)])
}
getExpirations(con)
getExpirations(con)
expirations <- getExpirations(con)
expirations
dt.spy
dt.spy
dt.portfolio
dt.portfolio
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-07')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-07', chr.expiration='2014-01-18',chr.option_type = 'c',int.strike = 186)[,qty:=0][,trade_id:=1]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio
getBestOption(data=dt.spy, chr.trade_date = '2014-01-03',chr.expiration = '2014-01-18', chr.option_type = 'c',int.min_delta = .5)
getBestOption(data=dt.spy, chr.trade_date = '2014-01-03',chr.expiration = '2014-01-18', chr.option_type = 'c',int.min_delta = .51)
getBestOption(data=dt.spy, chr.trade_date = '2014-01-03',chr.expiration = '2014-01-18', chr.option_type = 'c',int.min_delta = .55)
getBestOption(data=dt.spy, chr.trade_date = '2014-01-03',chr.expiration = '2014-01-18', chr.option_type = 'c',chr.money_in_out = 'out',int.min_dollar = 0)
getBestOption(data=dt.spy, chr.trade_date = '2014-01-03',chr.expiration = '2014-02-22', chr.option_type = 'c',chr.money_in_out = 'out',int.min_dollar = 0)
dt.portfolio
expirations
expirations[expiration>chr.trade_date]
expirations[expiration>chr.trade_date][order(expiration)]
expirations[expiration>chr.trade_date][order(expiration)][1,]
dt.atm <- getBestOption(data=dt.spy,
chr.trade_date = chr.trade_date,
chr.expiration =expirations[expiration>chr.trade_date][order(expiration)][1,]$expiration,
chr.option_type = 'c',
chr.money_in_out = 'out',
int.min_dollar = 0)
dt.atm
int.vol <- dt.atm$iv
dt.atm
chr.trade_date
dt.portfolio
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio
int.vol <- dt.atm$iv
int.underlying <- dt.atm$underlying
dt.portfolio[,sum(qty*delta)*100]
int.current_gamma <- dt.portfolio
dt.portfolio
dt.portfolio[trade_date==chr.trade_date]
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
chr.trade_date <- '2014-01-03'
dt.portfolio
dt.portfolio.slim <- dt.portfolio[trade_date==chr.trade_date]
dt.portfolio.slim
dt.portfolio.slim <- dt.portfolio.slim[!trade_id %in% dt.portfolio.slim[qty==0]$trade_id]
dt.portfolio.slim
int.current_delta <- dt.portfolio[,sum(qty*delta)*100]
int.current_delta
int.current_gamma <- dt.portfolio[,sum(qty*gamma)*100]
int.current_gamma
int.oneSDmove <- int.underlying*(int.vol)*(sqrt(1/365))
int.oneSDmove
int.range_gamma <- abs(int.oneSDmove * (int.current_gamma)/2 )
int.range_gamma
int.range_gamma
int.current_delta
list(current_delta = int.current_delta, range_gamma=int.range_gamma)
ls.metrics <- list(current_delta = int.current_delta, range_gamma=int.range_gamma)
getRangeAcceptableDelta <- function(data=dt.spy, chr.trade_date, dt.portfolio) {
dt.atm <- getBestOption(data=dt.spy,
chr.trade_date = chr.trade_date,
chr.expiration =expirations[expiration>chr.trade_date][order(expiration)][1,]$expiration,
chr.option_type = 'c',
chr.money_in_out = 'out',
int.min_dollar = 0)
int.vol <- dt.atm$iv
int.underlying <- dt.atm$underlying
dt.portfolio.slim <- dt.portfolio[trade_date==chr.trade_date]
dt.portfolio.slim <- dt.portfolio.slim[!trade_id %in% dt.portfolio.slim[qty==0]$trade_id]
int.current_delta <- dt.portfolio[,sum(qty*delta)*100]
int.current_gamma <- dt.portfolio[,sum(qty*gamma)*100]
int.oneSDmove <- int.underlying*(int.vol)*(sqrt(1/365))
int.range_gamma <- abs(int.oneSDmove * (int.current_gamma)/2 )
ls.metrics <- list(current_delta = int.current_delta, range_gamma=int.range_gamma)
return(ls.metrics)
}
suppressWarnings(source('~/rPackageFunctions/toCreate.R'))
suppressWarnings(source('~/rPackageFunctions/toCreateOptionFunctions.R'))
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
dt.portfolio
getRangeAcceptableDelta(chr.trade_date = '2014-01-06', dt.portfolio = dt.portfolio)
suppressWarnings(source('~/rPackageFunctions/toCreate.R'))
suppressWarnings(source('~/rPackageFunctions/toCreateOptionFunctions.R'))
dt.portfolio <- rbind(dt.pos1, dt.pos2)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-03')
q <- getBestOption(data = dt.spy, chr.trade_date= '2014-01-03', chr.expiration='2014-10-18',chr.option_type = 'c',int.strike = 195)[,qty:=0][,trade_id:=2]
dt.portfolio <- rbind(dt.portfolio, q)
dt.portfolio <- updateMarks(dt.portfolio=dt.portfolio, chr.trade_date = '2014-01-06')
getRangeAcceptableDelta(chr.trade_date = '2014-01-06', dt.portfolio = dt.portfolio)
